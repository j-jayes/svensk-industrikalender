---
title: "Figures"
format: html
---


```{r}
library(readxl)
library(tidyverse)

df <- readxl::read_excel("data/output/dbscan_clusters_business_counts.xlsx")

df <- df %>% 
mutate(foundation_year = parse_number(foundation_year)) 

# Define the dictionary
cluster_labels <- c("Glass & Mirror Factories",
                    "Spinning, weaving and textile industry",
                    "Iron and Steel Foundries",
                    "Chemical-technical industry, Chemical and pharmaceutical products, Paint and varnish factories",
                    "Various family owned businesses",
                    "Steel and metal industry",
                    "Building contractor, Concrete goods factory",
                    "Mechanical workshops for machine production (heavy industries)",
                    "Wood, sawmill and carpentry industry",
                    "Textile and leather processing industry",
                    "Book Printing and Publishing",
                    "Information Not Available",
                    "Metal goods factory, Mechanical workshop (light industries)",
                    "Preserved and fresh food industries",
                    "Food industry",
                    "Furniture and decoration factories",
                    "Breweries, malt and soft drink factories",
                    "Chemical-technical industry and jewellery",
                    "Electrical appliances and mechanical machinery",
                    "Clothing and textile industry")

# Create a dataframe
cluster_labels <- cluster_labels %>% 
    as_tibble() %>% 
    mutate(cluster = row_number() - 1) %>% 
    rename(cluster_label = value)

df <- df %>% 
inner_join(cluster_labels, by = "cluster") 
```



```{r}
df %>% 
ggplot(aes(x = foundation_year, fill = cluster_label)) +
geom_density(show.legend = FALSE) +
facet_wrap(~cluster_label) +
scale_x_continuous(limits = c(1850, 1947)) 

df %>% 
# create 5 year period to average over
mutate(foundation_year = foundation_year %/% 5 * 5) %>%
group_by(cluster_label, foundation_year) %>%
summarise(n = n()) %>%
ungroup() %>%
count(cluster_label, foundation_year) %>% ggplot(aes(x = foundation_year, y = n, fill = cluster_label)) +
geom_area(show.legend = FALSE, position = "fill") +
scale_x_continuous(limits = c(1850, 1947)) 


```

```{r}

```

```{r}

most_common_business_labels <- cluster_labels %>% 
rename(most_common_business_label = cluster_label,
       most_common_business = cluster) 

df %>% 
inner_join(most_common_business_labels) %>% 
ggplot(aes(coordinates_Longitude, coordinates_Latitude, colour = most_common_business_label)) +
geom_point() +
labs(colour = "Most common business by region") +
facet_wrap(~dbscan_cluster) +
scale_color_brewer(palette = "Paired") 

```




```{r}
most_specific_business_labels <- cluster_labels %>% 
rename(most_specific_business_label = cluster_label,
       most_specific_business = cluster) 

df %>% 
inner_join(most_specific_business_labels) %>% 
ggplot(aes(coordinates_Longitude, coordinates_Latitude, colour = most_common_business_label)) +
geom_point() +
labs(colour = "Most common business by region") +
facet_wrap(~dbscan_cluster) +
scale_color_brewer(palette = "Paired") 

df %>% colnames()
```
